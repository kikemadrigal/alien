10definta-z
20defusr=&h003B:a=usr(0):defusr1=&h003E:a=usr1(0):defusr2=&H90:a=usr2(0)
20defusr3=&H41:defusr4=&H44
100 print #1, "Cargando mapa en array (en RAM)"
110gosub13000:gosub13100
130gosub10000
520strig(0)on:onstriggosub10500
530'intervalon:oninterval=500gosub12500:beep
550gosub14000
560gosub13300
570gosub9000
2000gosub5000
2020gosub3100
2030gosub10300
2040gosub12700
2060'gosub9000
2090goto2000
2300a=usr2(0)
2310ifre=1thenPLAY"O5L8V4M8000AADFG2AAAAr60GEFDCDGR8A2A2A8","o1v4cr8o2cr8o1v6cr8o2v4cr8o1cr8o2v6cr8"
2350ifre=5thenplay"l10o4v4gc"
2360ifre=6thenplay"t250o5v12dv9e"
2370ifre=7thenplay"O5L8V4M8000AADFG2AAAA"
2380ifre=8thenPLAY"S1M2000T150O7C32"
2390ifre=9thenPLAY"o2l64t255v10m6500c"
2400ifre=10thensound6,5:sound8,16:sound12,6:sound13,9
2420return
3100'nada'
    3110 if mc>=200-32 then print #1,"FINAL": return
3120ifpx<0thenpx=0
3130ifpy>180thengoto10400
3140ifpx>256-16thenpx=-32:gosub10300:gosub13600:py=18*8:px=0
3150tx=px/8+mc:ty=py/8
3160t3=m(tx+1,ty+3)
3170t5=m(tx,ty+4)
3180t7=m(tx,ty+3)
3190ift3>=tfthenpx=px-pv
3200ift7>=tfthenpx=px+pv
3210ifpa=1andt5>=tfandpl<0thenpa=0:pl=-pl
3220ifpa=1thenpy=py-pl
3230ifpa=1andpy<po-20thenpl=-pl
3240ifpa=1andpy>pothenpy=po:pl=-pl:pa=0
3250ifpa=0andt5<tfthenpy=py+pl
3290return
5000'nada'
5010onstick(0)gosub5200,5400,5600,5800,6000,6200,6400,6600
5190return
5200ifpa<>1thenpo=py:pa=1
5290return
5400ifpa<>1thenpo=py:pa=1
5410px=px+pv
5420p1=0:p2=1:p4=4
5430swapp(0),p(1):p3=p(1)
5490return
5600px=px+pv
5610p1=0:p2=1:p4=4
5620swapp(0),p(1):p3=p(1)
5690return
5800'nada'
5890return
6000'nada'
6090return
6200'nada'
6290return
6400px=px-pv
6420p1=5:p2=6:p4=9
6440swapp(2),p(3):p3=p(3)
6490return
6600ifpa<>1thenpo=py:pa=1
6610px=px-pv
6620p1=5:p2=6:p4=9
6630swapp(2),p(3):p3=p(3)
6690return
9000line(0,180)-(256,212),1,bf
9050preset(10,180):print#1,"Muestras:0/Oxigeno:100%"
9060preset(10,190):print#1,"Vidas:10"
9090return
10000px=0:py=13*8:pw=16:ph=16:pv=8:pl=8:pj=0:pa=0:dimj(7):po=0
10010j(0)=-8:j(1)=-8:j(2)=-8:j(3)=0:j(4)=8:j(5)=8:j(6)=8
10020t1=0:t3=0:t5=0:t7=0
10020dimp(3):p(0)=2:p(1)=3:p(2)=7:p(3)=8:p1=0:p2=1:p3=2:p4=4
10030pp=0:ps=0:pc=0
10040pe=100
10050return
10300putspritepp,(px,py),9,p1
10310putspritepp+1,(px,py),10,p2
10320putspritepp+2,(px,py+16),9,p3
10330putspritepp+3,(px,py+8),15,p4
10390return
10400py=18*8:px=0
10410'restar1vida'
10490return
10500re=5:gosub2300
10510'po=py:pj=2:strig(0)off
10590return
11000dn=0:dd=0
11060return
12000em=3
12010DIMex(em),ey(em),ev(em),el(em),es(em),ep(em),ec(em),ee(em)
12020en=0
12030return
12500ifen>5thenreturn
12505'en=en+1
12510ex(en)=0:ey(en)=0
12530ev(en)=8:el(en)=8
12540es(en)=11+en*2:ep(en)=4+en:ec(en)=6
12550'ifec(en)<2thengoto11540
12560ee(en)=100
12570en=en+1
12580return
12600ex(ed)=ex(en):ey(ed)=ey(en):ev(ed)=ev(en):el(ed)=el(en):es(ed)=es(en):ep(ed)=ep(en):ec(ed)=ec(en):ee(ed)=ee(en)
12610putspriteep(en),(-16,-16),ec(en),es(en)
12650en=en-1
12660return
12700'ifen<=0thenreturn
12710fori=0toen-1
12720ex(i)=ex(i)-ev(i):ec(i)=ec(i)+1
12730ifex(i)mod5=0thenev(i)=-ev(i)
12770putspriteep(i),(ex(i),ey(i)),6,es(i)
12780'preset(0,150+i*10):print#1,"es:"es(i)",ep:"ep(i)",ex:"ex(i)
12790'ifex(i)<=0thened=i:gosub12600
12800nexti
12810return
    13000 print #1, "Definiendo array del mapa y pintando mapa"
13010dimm(200,26):mc=0
13020return
13100'estoalmacenaráelarrayapartirdelaposición8dc8delaRAM'
13110bload"world0.bin",r:gosub20000
13120md=&hc001
13130forf=0to23-1
13140forc=0to200-1
13150tn=peek(md):md=md+1
13160m(c,f)=tn
13170nextc
13180nextf
13190return
13300_turboon(m())
13310forf=0to23-1
13360forc=0to32-1
13370tn=m(c,f)
13380iftn>=0andtn<32thencopy(tn*8,0*8)-((tn*8)+8,(0*8)+8),1to(c*8,f*8),0,tpset
13390iftn>=32andtn<64thencopy((tn-32)*8,1*8)-(((tn-32)*8)+8,(1*8)+8),1to(c*8,f*8),0,tpset
13400iftn>=64andtn<96thencopy((tn-64)*8,2*8)-(((tn-64)*8)+8,(2*8)+8),1to(c*8,f*8),0,tpset
13410iftn>=96andtn<128thencopy((tn-96)*8,3*8)-(((tn-96)*8)+8,(3*8)+8),1to(c*8,f*8),0,tpset
13420iftn>=128andtn<160thencopy((tn-128)*8,4*8)-(((tn-128)*8)+8,(4*8)+8),1to(c*8,f*8),0,tpset
13430iftn>=160andtn<192thencopy((tn-160)*8,5*8)-(((tn-160)*8)+8,(5*8)+8),1to(c*8,f*8),0,tpset
13440iftn>=192andtn<224thencopy((tn-192)*8,6*8)-(((tn-192)*8)+8,(6*8)+8),1to(c*8,f*8),0,tpset
13450iftn>=224andtn<256thencopy((tn-224)*8,7*8)-(((tn-224)*8)+8,(7*8)+8),1to(c*8,f*8),0,tpset
13510nextc
13520nextf
13540_turbooff
13570return
13600ifmc=200-32thenreturn
13601_turboon(m(),mc)
13602fori=0to32
13605mc=mc+1
13610copy(8,0)-(256,212),0to(0,0),0,pset
13620forf=3to23-1
13630tn=m(31+mc,f)
13640iftn>=0andtn<32thencopy(tn*8,0*8)-((tn*8)+8,(0*8)+8),1to(31*8,f*8),0
13650iftn>=32andtn<64thencopy((tn-32)*8,1*8)-(((tn-32)*8)+8,(1*8)+8),1to(31*8,f*8),0
13660iftn>=64andtn<96thencopy((tn-64)*8,2*8)-(((tn-64)*8)+8,(2*8)+8),1to(31*8,f*8),0
13670iftn>=96andtn<128thencopy((tn-96)*8,3*8)-(((tn-96)*8)+8,(3*8)+8),1to(31*8,f*8),0
13680iftn>=128andtn<160thencopy((tn-128)*8,4*8)-(((tn-128)*8)+8,(4*8)+8),1to(31*8,f*8),0
13690iftn>=160andtn<192thencopy((tn-160)*8,5*8)-(((tn-160)*8)+8,(5*8)+8),1to(31*8,f*8),0
13700iftn>=192andtn<224thencopy((tn-192)*8,6*8)-(((tn-192)*8)+8,(6*8)+8),1to(31*8,f*8),0
13710iftn>=224andtn<256thencopy((tn-224)*8,7*8)-(((tn-224)*8)+8,(7*8)+8),1to(31*8,f*8),0
13720nextf
13730nexti
13735_turbooff
13736gosub9000
13740return
    14000 cls:preset (10,30):  print #1,"@@@@  @  @@@@  @ @@@@@ @  @   @"
    14010 preset (10,40):      print #1,"@    @ @ @@@@  @   @  @ @ @ @ @"
    14020 preset (10,50):      print #1,"@@@@@   @@     @   @ @   @@  @@"
    14030 preset (10,70):      print #1,"10540,capita Kik, debes ir a recoger las muestras fabricadas en otros entornos planetarios."
    14040 preset (10,110):     print #1,"Pero ten cuidado los esbirros de worst que te obstaculizan."
    14050 preset (10,160): print #1, "Cursores para mover, pulsa una tecla para continuar"
    14060 preset (10,180): print #1, "libre: "fre(0)
14070ifinkey$=""thengoto14070
14090return
20000wg=8
20010tf=160
20020gosub12500:ex(en-1)=4*8:ey(en-1)=20*8
20030gosub12500:ex(en-1)=26*8:ey(en-1)=20*8
20090return
